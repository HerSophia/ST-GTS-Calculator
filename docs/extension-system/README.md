# å·¨å¤§å¨˜è®¡ç®—å™¨ - æ‰©å±•ç³»ç»Ÿæ–‡æ¡£

> æœ¬æ–‡æ¡£æè¿°æ‰©å±•ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€å¼€å‘æŒ‡å—å’Œ API å‚è€ƒï¼Œå¸®åŠ©å¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰æ‰©å±•ã€‚

---

## ğŸ“‹ æ¦‚è¿°

æ‰©å±•ç³»ç»Ÿå…è®¸ç¬¬ä¸‰æ–¹å¼€å‘è€…ä¸ºå·¨å¤§å¨˜è®¡ç®—å™¨æ·»åŠ æ–°åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ”Œ **å¯æ’æ‹”è®¾è®¡** - æ‰©å±•å¯ä»¥ç‹¬ç«‹æ³¨å†Œã€å¯ç”¨ã€ç¦ç”¨
- ğŸ£ **ç”Ÿå‘½å‘¨æœŸé’©å­** - åœ¨å…³é”®èŠ‚ç‚¹æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘
- ğŸ“ **å†…å®¹è´¡çŒ®** - æ‰©å±•å¯ä»¥è´¡çŒ®æç¤ºè¯æ¨¡æ¿ã€UI ç»„ä»¶ç­‰
- ğŸ”— **ä¾èµ–ç®¡ç†** - æ‰©å±•å¯ä»¥å£°æ˜å¯¹å…¶ä»–æ‰©å±•çš„ä¾èµ–
- ğŸ’¾ **çŠ¶æ€æŒä¹…åŒ–** - å¯ç”¨çŠ¶æ€è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Extension Manager                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Extension  â”‚  â”‚   Extension  â”‚  â”‚   Extension  â”‚   ...     â”‚
â”‚  â”‚   (Damage)   â”‚  â”‚   (Custom)   â”‚  â”‚   (Custom)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Global API                               â”‚
â”‚              window.GiantessCalc.extensions.*                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†‘                    â†‘                    â†‘
    å†…ç½®æ‰©å±•              ç¬¬ä¸‰æ–¹æ‰©å±•           é…’é¦†åŠ©æ‰‹è„šæœ¬
```

---

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### æ³¨å†Œä¸€ä¸ªç®€å•æ‰©å±•

```javascript
// åœ¨å…¶ä»–é…’é¦†åŠ©æ‰‹è„šæœ¬ä¸­
if (window.GiantessCalc?.extensions) {
  window.GiantessCalc.extensions.register({
    id: 'my-extension',
    name: 'æˆ‘çš„æ‰©å±•',
    description: 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ‰©å±•',
    icon: 'fa-solid fa-star',
    defaultEnabled: true,
    
    onInit() {
      console.log('æ‰©å±•å·²åˆå§‹åŒ–');
    },
    
    onEnable() {
      console.log('æ‰©å±•å·²å¯ç”¨');
    },
    
    onDisable() {
      console.log('æ‰©å±•å·²ç¦ç”¨');
    },
  });
}
```

### ç­‰å¾…å·¨å¤§å¨˜è®¡ç®—å™¨åŠ è½½

ç”±äºé…’é¦†åŠ©æ‰‹è„šæœ¬çš„åŠ è½½é¡ºåºä¸ç¡®å®šï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç¡®ä¿æ­£ç¡®æ³¨å†Œï¼š

```javascript
function registerMyExtension() {
  if (!window.GiantessCalc?.extensions) {
    // å¦‚æœè¿˜æ²¡åŠ è½½ï¼Œç¨åé‡è¯•
    setTimeout(registerMyExtension, 100);
    return;
  }
  
  window.GiantessCalc.extensions.register({
    id: 'my-extension',
    name: 'æˆ‘çš„æ‰©å±•',
    // ...
  });
}

// å¼€å§‹æ³¨å†Œ
registerMyExtension();
```

---

## ğŸ”· æ‰©å±•æ¥å£å®šä¹‰

### Extension æ¥å£

```typescript
interface Extension {
  // ========== åŸºæœ¬ä¿¡æ¯ï¼ˆå¿…å¡«ï¼‰ ==========
  
  /** æ‰©å±•å”¯ä¸€æ ‡è¯†ï¼ˆæ¨èä½¿ç”¨ kebab-caseï¼‰ */
  id: string;
  
  /** æ‰©å±•åç§°ï¼ˆç”¨äº UI å±•ç¤ºï¼‰ */
  name: string;
  
  /** æ‰©å±•æè¿° */
  description: string;
  
  /** å›¾æ ‡ï¼ˆFont Awesome ç±»åï¼‰ */
  icon: string;
  
  // ========== å¯é€‰é…ç½® ==========
  
  /** æ˜¯å¦é»˜è®¤å¯ç”¨ï¼ˆé»˜è®¤ falseï¼‰ */
  defaultEnabled?: boolean;
  
  /** ä¾èµ–çš„å…¶ä»–æ‰©å±• ID åˆ—è¡¨ */
  dependencies?: string[];
  
  // ========== ç”Ÿå‘½å‘¨æœŸé’©å­ ==========
  
  /** æ‰©å±•æ³¨å†Œæ—¶è°ƒç”¨ï¼ˆæ— è®ºæ˜¯å¦å¯ç”¨ï¼‰ */
  onInit?: () => void | Promise<void>;
  
  /** æ‰©å±•å¯ç”¨æ—¶è°ƒç”¨ */
  onEnable?: () => void | Promise<void>;
  
  /** æ‰©å±•ç¦ç”¨æ—¶è°ƒç”¨ */
  onDisable?: () => void | Promise<void>;
  
  // ========== è®¡ç®—é’©å­ ==========
  
  /** è§’è‰²æ•°æ®æ›´æ–°åè°ƒç”¨ */
  onCharacterUpdate?: (
    character: CharacterData,
    calcData: GiantessData | TinyData
  ) => void | Record<string, unknown>;
  
  /** æç¤ºè¯æ³¨å…¥å‰è°ƒç”¨ï¼Œå¯ä»¥ä¿®æ”¹ä¸Šä¸‹æ–‡ */
  onBeforePromptInject?: (context: PromptContext) => PromptContext;
  
  /** æç¤ºè¯æ³¨å…¥åè°ƒç”¨ */
  onAfterPromptInject?: (promptId: string) => void;
  
  // ========== å†…å®¹è´¡çŒ® ==========
  
  /** è´¡çŒ®çš„æç¤ºè¯æ¨¡æ¿ */
  getPromptTemplates?: () => PromptTemplate[];
  
  /** è´¡çŒ®è¿½åŠ åˆ°ä¸»è§„åˆ™æ¨¡æ¿çš„è§„åˆ™ç‰‡æ®µ */
  getRulesContribution?: () => string | null;
  
  /** è´¡çŒ®çš„è®¾ç½®é¡¹ç»„ä»¶ï¼ˆVue ç»„ä»¶ï¼‰ */
  getSettingsComponent?: () => Component;
  
  /** è´¡çŒ®çš„è§’è‰²å¡ç‰‡é¢å¤–å†…å®¹ï¼ˆVue ç»„ä»¶ï¼‰ */
  getCharacterCardExtra?: () => Component;
  
  /**
   * åˆ¤æ–­æ˜¯å¦åº”è¯¥ä¸ºè¯¥è§’è‰²æ˜¾ç¤ºå¡ç‰‡å†…å®¹
   * @param context è§’è‰²å¡ç‰‡ä¸Šä¸‹æ–‡
   * @returns æ˜¯å¦æ˜¾ç¤º
   */
  shouldShowCardContent?: (context: CharacterCardContext) => boolean;
  
  /** è´¡çŒ®çš„è°ƒè¯•é¢æ¿å†…å®¹ï¼ˆVue ç»„ä»¶ï¼‰ */
  getDebugPanelExtra?: () => Component;
}
```

---

## ğŸ£ ç”Ÿå‘½å‘¨æœŸé’©å­

### é’©å­è°ƒç”¨æ—¶æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ‰©å±•ç”Ÿå‘½å‘¨æœŸ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  æ³¨å†Œæ‰©å±•                                                        â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚ onInit() â”‚ â† æ³¨å†Œæ—¶ç«‹å³è°ƒç”¨ï¼ˆæ— è®ºæ˜¯å¦å¯ç”¨ï¼‰                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  æ£€æŸ¥ defaultEnabled                                             â”‚
â”‚      â”‚                                                          â”‚
â”‚      â”œâ”€â”€â”€ true â”€â”€â”€â”€â”                                            â”‚
â”‚      â”‚             â–¼                                            â”‚
â”‚      â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚      â”‚     â”‚ onEnable() â”‚ â† å¯ç”¨æ—¶è°ƒç”¨                          â”‚
â”‚      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚      â”‚             â”‚                                            â”‚
â”‚      â””â”€â”€â”€ false â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                                              â”‚  â”‚
â”‚                    ç­‰å¾…ç”¨æˆ·æ“ä½œ                               â”‚  â”‚
â”‚                          â”‚                                   â”‚  â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚      â”‚                   â”‚                   â”‚               â”‚  â”‚
â”‚      â–¼                   â–¼                   â–¼               â”‚  â”‚
â”‚  ç”¨æˆ·å¯ç”¨            è§’è‰²æ›´æ–°           æç¤ºè¯æ³¨å…¥             â”‚  â”‚
â”‚      â”‚                   â”‚                   â”‚               â”‚  â”‚
â”‚      â–¼                   â–¼                   â–¼               â”‚  â”‚
â”‚  onEnable()    onCharacterUpdate()   onBeforePromptInject()  â”‚  â”‚
â”‚      â”‚                   â”‚           onAfterPromptInject()   â”‚  â”‚
â”‚      â”‚                   â”‚                   â”‚               â”‚  â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚                          â”‚                                   â”‚  â”‚
â”‚                      ç”¨æˆ·ç¦ç”¨                                 â”‚  â”‚
â”‚                          â”‚                                   â”‚  â”‚
â”‚                          â–¼                                   â”‚  â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
â”‚                  â”‚ onDisable() â”‚ â† ç¦ç”¨æ—¶è°ƒç”¨                 â”‚  â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚                                                              â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜
```

### onInit()

åœ¨æ‰©å±•æ³¨å†Œæ—¶ç«‹å³è°ƒç”¨ï¼Œæ— è®ºæ‰©å±•æ˜¯å¦å¯ç”¨ã€‚é€‚åˆè¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–æ“ä½œã€‚

```javascript
onInit() {
  // åˆå§‹åŒ–èµ„æº
  this.myResource = loadResource();
  console.log('æ‰©å±•å·²åˆå§‹åŒ–');
}
```

**æ³¨æ„**ï¼š
- æ­¤é’©å­åœ¨æ‰©å±•æ³¨å†Œæ—¶åŒæ­¥è°ƒç”¨
- ä¸è¦åœ¨æ­¤å¤„æ‰§è¡Œè€—æ—¶æ“ä½œ
- å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰©å±•ä»ä¼šè¢«æ³¨å†Œï¼Œä½†ä¼šæ‰“å°é”™è¯¯æ—¥å¿—

### onEnable()

åœ¨æ‰©å±•å¯ç”¨æ—¶è°ƒç”¨ã€‚å¯ä»¥æ˜¯ç”¨æˆ·æ‰‹åŠ¨å¯ç”¨ï¼Œæˆ–è€… `defaultEnabled: true` æ—¶è‡ªåŠ¨å¯ç”¨ã€‚

```javascript
onEnable() {
  // å¯åŠ¨åå°æœåŠ¡
  this.startService();
  // æ³¨å†Œäº‹ä»¶ç›‘å¬
  this.registerEventListeners();
  console.log('æ‰©å±•å·²å¯ç”¨');
}
```

**æ³¨æ„**ï¼š
- å¦‚æœæ‰©å±•æœ‰ä¾èµ–ï¼Œåªæœ‰å½“æ‰€æœ‰ä¾èµ–éƒ½å¯ç”¨åæ‰ä¼šè°ƒç”¨
- å¦‚æœæ­¤é’©å­æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰©å±•ä¼šè¢«æ ‡è®°ä¸ºç¦ç”¨çŠ¶æ€

### onDisable()

åœ¨æ‰©å±•ç¦ç”¨æ—¶è°ƒç”¨ã€‚

```javascript
onDisable() {
  // åœæ­¢åå°æœåŠ¡
  this.stopService();
  // ç§»é™¤äº‹ä»¶ç›‘å¬
  this.removeEventListeners();
  // æ¸…ç†èµ„æº
  this.cleanup();
  console.log('æ‰©å±•å·²ç¦ç”¨');
}
```

**æ³¨æ„**ï¼š
- å¦‚æœæœ‰å…¶ä»–æ‰©å±•ä¾èµ–æ­¤æ‰©å±•ï¼Œç¦ç”¨ä¼šå¤±è´¥
- å³ä½¿æ­¤é’©å­æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰©å±•ä¹Ÿä¼šè¢«æ ‡è®°ä¸ºç¦ç”¨çŠ¶æ€

### shouldShowCardContent(context)

åˆ¤æ–­æ˜¯å¦åº”è¯¥ä¸ºè¯¥è§’è‰²æ˜¾ç¤ºå¡ç‰‡å†…å®¹ã€‚**åªå¯¹å·²å¯ç”¨çš„æ‰©å±•è°ƒç”¨**ã€‚

```javascript
shouldShowCardContent(context) {
  // åªå¯¹å·¨å¤§å¨˜ï¼ˆå€ç‡ >= 10ï¼‰æ˜¾ç¤º
  if (!context.calcData || context.calcData.å€ç‡ < 10) {
    return false;
  }
  // åªåœ¨å¡ç‰‡å±•å¼€æ—¶æ˜¾ç¤º
  if (!context.expanded) {
    return false;
  }
  return true;
}
```

**CharacterCardContext ç»“æ„**ï¼š

```typescript
interface CharacterCardContext {
  /** è§’è‰²æ•°æ® */
  character: CharacterData;
  /** è®¡ç®—æ•°æ® */
  calcData: GiantessData | TinyData | null;
  /** æ˜¯å¦å±•å¼€ */
  expanded: boolean;
}
```

**æ³¨æ„**ï¼š
- å¦‚æœä¸å®ç°æ­¤æ–¹æ³•ï¼Œé»˜è®¤ä¼šæ˜¾ç¤ºï¼ˆåªè¦ `getCharacterCardExtra` è¿”å›äº†ç»„ä»¶ï¼‰
- è¿”å› `false` æ—¶ï¼Œå¯¹åº”çš„å¡ç‰‡ç»„ä»¶ä¸ä¼šè¢«æ¸²æŸ“
- å¯ä»¥æ ¹æ®è§’è‰²ç±»å‹ã€å€ç‡ã€å±•å¼€çŠ¶æ€ç­‰æ¡ä»¶å†³å®šæ˜¯å¦æ˜¾ç¤º

---

### onCharacterUpdate(character, calcData)

åœ¨è§’è‰²æ•°æ®æ›´æ–°åè°ƒç”¨ã€‚**åªå¯¹å·²å¯ç”¨çš„æ‰©å±•è°ƒç”¨**ã€‚

```javascript
onCharacterUpdate(character, calcData) {
  console.log(`è§’è‰² ${character.name} æ›´æ–°äº†`);
  console.log(`å½“å‰èº«é«˜: ${character.currentHeight}ç±³`);
  console.log(`å€ç‡: ${calcData.å€ç‡}`);
  
  // å¯ä»¥è¿”å›é¢å¤–æ•°æ®ï¼Œä¼šè¢«å†™å…¥ MVU å˜é‡
  return {
    _æˆ‘çš„æ‰©å±•æ•°æ®: {
      someValue: 123,
      computed: calcData.å€ç‡ * 2,
    },
  };
}
```

**å‚æ•°**ï¼š

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `character` | `CharacterData` | è§’è‰²åŸºæœ¬ä¿¡æ¯ |
| `calcData` | `GiantessData \| TinyData` | è®¡ç®—ç»“æœ |

**CharacterData ç»“æ„**ï¼š

```typescript
interface CharacterData {
  name: string;           // è§’è‰²åç§°
  currentHeight: number;  // å½“å‰èº«é«˜ï¼ˆç±³ï¼‰
  originalHeight: number; // åŸå§‹èº«é«˜ï¼ˆç±³ï¼‰
  changeReason?: string;  // å˜åŒ–åŸå› 
  changeTime?: string;    // å˜åŒ–æ—¶é—´
  customParts?: Record<string, number>; // è‡ªå®šä¹‰éƒ¨ä½å°ºå¯¸
  calcData?: CalcData;    // è®¡ç®—ç»“æœ
  damageData?: DamageCalculation; // æŸå®³æ•°æ®
  actualDamage?: ActualDamage; // å®é™…æŸå®³è®°å½•
  heightHistory?: HeightRecord[]; // èº«é«˜å†å²
}
```

**è¿”å›å€¼**ï¼š
- è¿”å› `void` è¡¨ç¤ºä¸éœ€è¦é¢å¤–æ•°æ®
- è¿”å› `Record<string, unknown>` ä¼šè¢«åˆå¹¶åˆ°è§’è‰²çš„ MVU å˜é‡ä¸­

### onBeforePromptInject(context)

åœ¨æç¤ºè¯æ³¨å…¥å‰è°ƒç”¨ï¼Œå¯ä»¥ä¿®æ”¹æç¤ºè¯ä¸Šä¸‹æ–‡ã€‚**åªå¯¹å·²å¯ç”¨çš„æ‰©å±•è°ƒç”¨**ã€‚

```javascript
onBeforePromptInject(context) {
  // ä¿®æ”¹ä¸Šä¸‹æ–‡
  context.extraContent = context.extraContent || '';
  context.extraContent += '\n\n## æˆ‘çš„æ‰©å±•æ·»åŠ çš„å†…å®¹\n...';
  
  // å¿…é¡»è¿”å›ä¿®æ”¹åçš„ä¸Šä¸‹æ–‡
  return context;
}
```

**PromptContext ç»“æ„**ï¼š

```typescript
interface PromptContext {
  characters: CharacterData[];  // æ‰€æœ‰è§’è‰²
  worldview?: Worldview;        // å½“å‰ä¸–ç•Œè§‚
  scenario?: string;            // å½“å‰åœºæ™¯
  extraContent?: string;        // é¢å¤–å†…å®¹
}
```

### onAfterPromptInject(promptId)

åœ¨æç¤ºè¯æ³¨å…¥åè°ƒç”¨ã€‚**åªå¯¹å·²å¯ç”¨çš„æ‰©å±•è°ƒç”¨**ã€‚

```javascript
onAfterPromptInject(promptId) {
  console.log(`æç¤ºè¯å·²æ³¨å…¥ï¼Œæ¡ç›® ID: ${promptId}`);
  // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›åå¤„ç†
}
```

---

## ğŸ“ å†…å®¹è´¡çŒ®

æ‰©å±•å¯ä»¥å‘ç³»ç»Ÿè´¡çŒ®å„ç§å†…å®¹ï¼Œè¿™äº›å†…å®¹ä¼šåœ¨æ‰©å±•å¯ç”¨æ—¶ç”Ÿæ•ˆã€‚

### getPromptTemplates()

è´¡çŒ®æç¤ºè¯æ¨¡æ¿ï¼Œä¼šå‡ºç°åœ¨æç¤ºè¯ç®¡ç†é¢æ¿ä¸­ã€‚

```javascript
getPromptTemplates() {
  return [
    {
      id: 'my-extension-prompt',      // å”¯ä¸€ ID
      name: 'æˆ‘çš„æç¤ºè¯',              // æ˜¾ç¤ºåç§°
      description: 'è¿™æ˜¯æˆ‘çš„æç¤ºè¯',   // æè¿°
      enabled: true,                   // æ˜¯å¦é»˜è®¤å¯ç”¨
      order: 9950,                     // æ’åºï¼ˆè¶Šå¤§è¶Šé å‰ï¼‰
      type: 'custom',                  // ç±»å‹
      builtin: false,                  // æ˜¯å¦å†…ç½®
      readonly: false,                 // æ˜¯å¦åªè¯»
      requiresFeature: null,           // ä¾èµ–çš„åŠŸèƒ½å¼€å…³
      content: `## æˆ‘çš„æç¤ºè¯å†…å®¹

è¿™é‡Œæ˜¯æç¤ºè¯å†…å®¹ï¼Œæ”¯æŒæ¨¡æ¿å˜é‡ï¼š
- {{è§’è‰²å}}
- {{å½“å‰èº«é«˜}}
- {{å€ç‡}}
`,
    },
  ];
}
```

**PromptTemplate å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `id` | `string` | âœ… | å”¯ä¸€æ ‡è¯†ç¬¦ |
| `name` | `string` | âœ… | æ˜¾ç¤ºåç§° |
| `description` | `string` | âœ… | æè¿° |
| `enabled` | `boolean` | âœ… | æ˜¯å¦å¯ç”¨ |
| `order` | `number` | âœ… | æ’åºæƒé‡ï¼ˆè¶Šå¤§è¶Šé å‰ï¼‰ |
| `type` | `string` | âœ… | ç±»å‹ï¼šheader/character/interaction/worldview/damage/rules/footer/custom |
| `builtin` | `boolean` | - | æ˜¯å¦å†…ç½®æ¨¡æ¿ |
| `readonly` | `boolean` | - | æ˜¯å¦åªè¯» |
| `requiresFeature` | `string` | - | ä¾èµ–çš„åŠŸèƒ½å¼€å…³ |
| `content` | `string` | âœ… | æ¨¡æ¿å†…å®¹ |

**å¯ç”¨çš„æ¨¡æ¿å˜é‡**ï¼š

| å˜é‡ | è¯´æ˜ |
|------|------|
| `{{è§’è‰²å}}` | è§’è‰²åç§° |
| `{{å½“å‰èº«é«˜}}` | å½“å‰èº«é«˜ï¼ˆæ•°å€¼ï¼‰ |
| `{{å½“å‰èº«é«˜_æ ¼å¼åŒ–}}` | å½“å‰èº«é«˜ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ |
| `{{åŸèº«é«˜}}` | åŸå§‹èº«é«˜ï¼ˆæ•°å€¼ï¼‰ |
| `{{åŸèº«é«˜_æ ¼å¼åŒ–}}` | åŸå§‹èº«é«˜ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ |
| `{{å€ç‡}}` | ç¼©æ”¾å€ç‡ |
| `{{çº§åˆ«}}` | çº§åˆ«åç§° |
| `{{æè¿°}}` | çº§åˆ«æè¿° |
| `{{èº«ä½“æ•°æ®}}` | æ ¼å¼åŒ–çš„èº«ä½“éƒ¨ä½æ•°æ® |
| `{{ç›¸å¯¹å‚ç…§}}` | æ ¼å¼åŒ–çš„ç›¸å¯¹å‚ç…§ç‰© |
| `{{äº’åŠ¨é™åˆ¶åˆ—è¡¨}}` | æ ¼å¼åŒ–çš„äº’åŠ¨é™åˆ¶åˆ—è¡¨ |
| `{{æŸå®³æ•°æ®}}` | æ ¼å¼åŒ–çš„æŸå®³è®¡ç®—æ•°æ® |
| `{{ä¸–ç•Œè§‚æç¤ºè¯}}` | å½“å‰ä¸–ç•Œè§‚çš„å®Œæ•´æç¤ºè¯ |
| `{{ä¸–ç•Œè§‚åç§°}}` | å½“å‰ä¸–ç•Œè§‚åç§° |

### getRulesContribution()

è´¡çŒ®è¿½åŠ åˆ°ä¸»è§„åˆ™æ¨¡æ¿çš„è§„åˆ™ç‰‡æ®µã€‚è¿™äº›è§„åˆ™ä¼šè¢«è¿½åŠ åˆ°ã€Œå˜é‡æ›´æ–°è§„åˆ™ã€æ¨¡æ¿çš„æœ«å°¾ã€‚

```javascript
getRulesContribution() {
  return `## æˆ‘çš„æ‰©å±•è§„åˆ™

å½“æ»¡è¶³æŸäº›æ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

\`\`\`xml
<gts_update>
_.set('å·¨å¤§å¨˜.è§’è‰².{{è§’è‰²å}}._æˆ‘çš„æ•°æ®', { value: 123 });
</gts_update>
\`\`\`
`;
}
```

**æ³¨æ„**ï¼š
- è¿”å› `null` è¡¨ç¤ºä¸è´¡çŒ®è§„åˆ™
- è§„åˆ™å†…å®¹åº”è¯¥æ˜¯ Markdown æ ¼å¼
- è§„åˆ™ä¼šæŒ‰æ‰©å±•å¯ç”¨é¡ºåºè¿½åŠ 

### getSettingsComponent()

è´¡çŒ®è®¾ç½®é¡¹ç»„ä»¶ï¼Œä¼šæ˜¾ç¤ºåœ¨æ‰©å±•é¢æ¿ä¸­ã€‚

```javascript
import { defineComponent, h } from 'vue';

getSettingsComponent() {
  return defineComponent({
    name: 'MyExtensionSettings',
    setup() {
      const enabled = ref(true);
      
      return () => h('div', [
        h('label', [
          h('input', {
            type: 'checkbox',
            checked: enabled.value,
            onChange: (e) => { enabled.value = e.target.checked; },
          }),
          'å¯ç”¨æŸä¸ªåŠŸèƒ½',
        ]),
      ]);
    },
  });
}
```

**æ³¨æ„**ï¼š
- ç»„ä»¶åº”è¯¥æ˜¯ä¸€ä¸ª Vue 3 ç»„ä»¶
- æ¨èä½¿ç”¨ `defineComponent` + `h` å‡½æ•°ï¼ˆæ¸²æŸ“å‡½æ•°ï¼‰
- ä¹Ÿå¯ä»¥ä½¿ç”¨ SFC æ ¼å¼ï¼Œä½†éœ€è¦æ„å»ºå·¥å…·æ”¯æŒ

### getCharacterCardExtra()

è´¡çŒ®è§’è‰²å¡ç‰‡çš„é¢å¤–å†…å®¹ï¼Œä¼šæ˜¾ç¤ºåœ¨æ¯ä¸ªè§’è‰²å¡ç‰‡çš„è¯¦æƒ…åŒºåŸŸä¸­ã€‚

```javascript
import { defineComponent, h, ref } from 'vue';

getCharacterCardExtra() {
  return defineComponent({
    name: 'MyCharacterExtra',
    props: {
      character: {
        type: Object,
        required: true,
      },
      calcData: {
        type: Object,
        default: null,
      },
      expanded: {
        type: Boolean,
        default: false,
      },
    },
    setup(props) {
      const localState = ref(false);
      
      return () => h('div', { class: 'gc-ext-my-section' }, [
        // æ ‡é¢˜è¡Œ
        h('div', { class: 'gc-ext-section-title' }, [
          h('i', { class: 'fa-solid fa-star' }),
          h('span', ' æˆ‘çš„æ‰©å±•æ•°æ®'),
          h('span', { class: 'gc-ext-badge' }, 'è‡ªå®šä¹‰'),
        ]),
        // å†…å®¹
        h('div', { class: 'gc-ext-grid' }, [
          h('div', { class: 'gc-ext-item' }, [
            h('div', { class: 'gc-ext-label' }, 'å€ç‡'),
            h('div', { class: 'gc-ext-value' }, props.calcData?.å€ç‡ || '-'),
          ]),
          h('div', { class: 'gc-ext-item' }, [
            h('div', { class: 'gc-ext-label' }, 'è‡ªå®šä¹‰å€¼'),
            h('div', { class: 'gc-ext-value' }, 
              props.character._æˆ‘çš„æ‰©å±•æ•°æ®?.someValue || 'æ— '
            ),
          ]),
        ]),
      ]);
    },
  });
}
```

**ç»„ä»¶ Props**ï¼š

| Prop | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `character` | `CharacterData` | å®Œæ•´çš„è§’è‰²æ•°æ®å¯¹è±¡ |
| `calcData` | `GiantessData \| TinyData \| null` | è®¡ç®—ç»“æœæ•°æ® |
| `expanded` | `boolean` | è§’è‰²å¡ç‰‡æ˜¯å¦å¤„äºå±•å¼€çŠ¶æ€ |

**æ¨èçš„ CSS ç±»å**ï¼ˆä¸å†…ç½®æ‰©å±•ä¿æŒä¸€è‡´ï¼‰ï¼š

| ç±»å | ç”¨é€” |
|------|------|
| `gc-ext-*-section` | æ‰©å±•åŒºå—å®¹å™¨ |
| `gc-ext-section-title` | åŒºå—æ ‡é¢˜ |
| `gc-ext-badge` | æ ‡é¢˜å³ä¾§çš„å¾½ç«  |
| `gc-ext-grid` | æ•°æ®ç½‘æ ¼å¸ƒå±€ |
| `gc-ext-item` | ç½‘æ ¼é¡¹ |
| `gc-ext-label` | æ•°æ®æ ‡ç­¾ |
| `gc-ext-value` | æ•°æ®å€¼ |

**æ³¨æ„**ï¼š
- ç»„ä»¶åº”è¯¥æ˜¯è½»é‡çº§çš„ï¼Œé¿å…å¤æ‚è®¡ç®—
- ä½¿ç”¨ `gc-ext-` å‰ç¼€çš„ CSS ç±»åå¯è·å¾—å†…ç½®æ ·å¼æ”¯æŒ
- ç»„ä»¶å†…çš„æ ·å¼ä½¿ç”¨å…¨å±€ CSSï¼ˆä¸èƒ½ä½¿ç”¨ `scoped`ï¼‰

### getDebugPanelExtra()

è´¡çŒ®è°ƒè¯•é¢æ¿çš„é¢å¤–å†…å®¹ã€‚

```javascript
getDebugPanelExtra() {
  return defineComponent({
    name: 'MyDebugExtra',
    setup() {
      const debugData = ref(null);
      
      const loadData = () => {
        debugData.value = { /* ... */ };
      };
      
      return () => h('div', { class: 'my-debug' }, [
        h('button', { onClick: loadData }, 'åŠ è½½è°ƒè¯•æ•°æ®'),
        debugData.value && h('pre', JSON.stringify(debugData.value, null, 2)),
      ]);
    },
  });
}
```

---

## ğŸ”— ä¾èµ–ç®¡ç†

æ‰©å±•å¯ä»¥å£°æ˜å¯¹å…¶ä»–æ‰©å±•çš„ä¾èµ–ã€‚

### å£°æ˜ä¾èµ–

```javascript
window.GiantessCalc.extensions.register({
  id: 'my-advanced-extension',
  name: 'é«˜çº§æ‰©å±•',
  dependencies: ['damage-calculation', 'another-extension'],
  // ...
});
```

### ä¾èµ–è§„åˆ™

1. **å¯ç”¨æ—¶**ï¼šåªæœ‰å½“æ‰€æœ‰ä¾èµ–éƒ½å·²å¯ç”¨ï¼Œæ‰©å±•æ‰èƒ½è¢«å¯ç”¨
2. **ç¦ç”¨æ—¶**ï¼šå¦‚æœæœ‰å…¶ä»–æ‰©å±•ä¾èµ–æ­¤æ‰©å±•ï¼Œåˆ™æ— æ³•ç¦ç”¨
3. **æ³¨å†Œæ—¶**ï¼šä¾èµ–çš„æ‰©å±•ä¸éœ€è¦å…ˆæ³¨å†Œï¼Œä½†å¯ç”¨æ—¶éœ€è¦å­˜åœ¨

### æ£€æŸ¥ä¾èµ–

```javascript
const canEnable = window.GiantessCalc.extensions.canEnable('my-advanced-extension');
if (!canEnable.success) {
  console.log('æ— æ³•å¯ç”¨:', canEnable.reason);
  console.log('ç¼ºå¤±çš„ä¾èµ–:', canEnable.missingDependencies);
}
```

---

## ğŸ“š API å‚è€ƒ

### å…¨å±€ API

æ‰©å±•ç³»ç»Ÿé€šè¿‡ `window.GiantessCalc.extensions` æš´éœ² APIã€‚

#### register(extension)

æ³¨å†Œä¸€ä¸ªæ‰©å±•ã€‚

```javascript
window.GiantessCalc.extensions.register(extension: Extension): void
```

**å‚æ•°**ï¼š
- `extension`: æ‰©å±•å®šä¹‰å¯¹è±¡

**ç¤ºä¾‹**ï¼š
```javascript
window.GiantessCalc.extensions.register({
  id: 'my-extension',
  name: 'æˆ‘çš„æ‰©å±•',
  description: 'æè¿°',
  icon: 'fa-solid fa-star',
});
```

#### get(id)

è·å–æŒ‡å®šæ‰©å±•ã€‚

```javascript
window.GiantessCalc.extensions.get(id: string): Extension | undefined
```

#### getAll()

è·å–æ‰€æœ‰å·²æ³¨å†Œçš„æ‰©å±•ã€‚

```javascript
window.GiantessCalc.extensions.getAll(): Extension[]
```

#### getEnabled()

è·å–æ‰€æœ‰å·²å¯ç”¨çš„æ‰©å±•ã€‚

```javascript
window.GiantessCalc.extensions.getEnabled(): Extension[]
```

#### enable(id)

å¯ç”¨æŒ‡å®šæ‰©å±•ã€‚

```javascript
window.GiantessCalc.extensions.enable(id: string): boolean
```

**è¿”å›**ï¼šæ˜¯å¦æˆåŠŸå¯ç”¨

#### disable(id)

ç¦ç”¨æŒ‡å®šæ‰©å±•ã€‚

```javascript
window.GiantessCalc.extensions.disable(id: string): boolean
```

**è¿”å›**ï¼šæ˜¯å¦æˆåŠŸç¦ç”¨

#### toggle(id)

åˆ‡æ¢æ‰©å±•çš„å¯ç”¨çŠ¶æ€ã€‚

```javascript
window.GiantessCalc.extensions.toggle(id: string): boolean
```

**è¿”å›**ï¼šåˆ‡æ¢åçš„å¯ç”¨çŠ¶æ€

#### isEnabled(id)

æ£€æŸ¥æ‰©å±•æ˜¯å¦å¯ç”¨ã€‚

```javascript
window.GiantessCalc.extensions.isEnabled(id: string): boolean
```

#### getInfo(id)

è·å–æ‰©å±•çš„è¯¦ç»†ä¿¡æ¯ã€‚

```javascript
window.GiantessCalc.extensions.getInfo(id: string): ExtensionInfo | null

interface ExtensionInfo {
  extension: Extension;
  enabled: boolean;
  canDisable: boolean;
  canEnable: boolean;
  missingDependencies?: string[];
}
```

#### getAllInfo()

è·å–æ‰€æœ‰æ‰©å±•çš„è¯¦ç»†ä¿¡æ¯ã€‚

```javascript
window.GiantessCalc.extensions.getAllInfo(): ExtensionInfo[]
```

---

## ğŸ¯ å¼€å‘æŒ‡å—

### æœ€ä½³å®è·µ

#### 1. ä½¿ç”¨å”¯ä¸€çš„ ID

æ¨èä½¿ç”¨ `ä½œè€…å-æ‰©å±•å` çš„æ ¼å¼é¿å…å†²çªï¼š

```javascript
{
  id: 'myname-awesome-extension',
  // ...
}
```

#### 2. åœ¨ onDisable ä¸­æ¸…ç†èµ„æº

ç¡®ä¿æ‰©å±•ç¦ç”¨æ—¶æ­£ç¡®æ¸…ç†ï¼š

```javascript
onEnable() {
  this.timer = setInterval(() => { /* ... */ }, 1000);
  window.addEventListener('resize', this.handleResize);
},

onDisable() {
  if (this.timer) {
    clearInterval(this.timer);
    this.timer = null;
  }
  window.removeEventListener('resize', this.handleResize);
}
```

#### 3. ä½¿ç”¨å‰ç¼€é¿å…æ•°æ®å†²çª

åœ¨ MVU å˜é‡ä¸­ä½¿ç”¨å”¯ä¸€å‰ç¼€ï¼š

```javascript
onCharacterUpdate(character, calcData) {
  return {
    _myExtension_data: {  // ä½¿ç”¨å‰ç¼€
      value: 123,
    },
  };
}
```

#### 4. ä¼˜é›…é™çº§

æ£€æŸ¥ä¾èµ–çš„åŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼š

```javascript
onCharacterUpdate(character, calcData) {
  // æ£€æŸ¥æŸå®³æ•°æ®æ˜¯å¦å­˜åœ¨
  if (!character.damageData) {
    return; // ä¼˜é›…é™çº§
  }
  
  // ä½¿ç”¨æŸå®³æ•°æ®
  const damage = character.damageData;
  // ...
}
```

#### 5. æä¾›æœ‰æ„ä¹‰çš„æ—¥å¿—

ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—å‰ç¼€ï¼š

```javascript
const LOG_PREFIX = '[MyExtension]';

onInit() {
  console.log(`${LOG_PREFIX} åˆå§‹åŒ–`);
},

onEnable() {
  console.log(`${LOG_PREFIX} å·²å¯ç”¨`);
},

onCharacterUpdate(character) {
  console.log(`${LOG_PREFIX} å¤„ç†è§’è‰²: ${character.name}`);
}
```

### è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹å·²æ³¨å†Œçš„æ‰©å±•

```javascript
console.table(window.GiantessCalc.extensions.getAllInfo());
```

#### æ‰‹åŠ¨è§¦å‘è§’è‰²æ›´æ–°

```javascript
// è·å–å½“å‰è§’è‰²æ•°æ®
const characters = window.GiantessCalc.debug.getMvuInfo().registeredCharacters;

// æŸ¥çœ‹æŸä¸ªæ‰©å±•çš„å¤„ç†ç»“æœ
const ext = window.GiantessCalc.extensions.get('my-extension');
const result = ext.onCharacterUpdate?.(character, calcData);
console.log('æ‰©å±•è¿”å›:', result);
```

#### æµ‹è¯•æç¤ºè¯è´¡çŒ®

```javascript
const ext = window.GiantessCalc.extensions.get('my-extension');
const templates = ext.getPromptTemplates?.();
console.log('æç¤ºè¯æ¨¡æ¿:', templates);
```

---

## ğŸ“¦ å†…ç½®æ‰©å±•

### æŸå®³è®¡ç®—æ‰©å±• (damage-calculation)

è®¡ç®—å·¨å¤§å¨˜è¡ŒåŠ¨å¯èƒ½é€ æˆçš„ç ´åã€‚

**ID**ï¼š`damage-calculation`

**åŠŸèƒ½**ï¼š
- è®¡ç®—è¶³è¿¹å½±å“èŒƒå›´
- ä¼°ç®—äººå‘˜ä¼¤äº¡
- ä¼°ç®—å»ºç­‘æŸæ¯
- è®¡ç®—å®è§‚ç ´ååŠ›ç­‰çº§
- ç”Ÿæˆç‰¹æ®Šç‰©ç†æ•ˆåº”æç¤º

**è´¡çŒ®çš„æ•°æ®**ï¼š
```javascript
{
  _æŸå®³æ•°æ®: {
    è¶³è¿¹: {
      é•¿åº¦: number,
      å®½åº¦: number,
      é¢ç§¯: number,
      è¦†ç›–è¡—é“: number,
    },
    æ¯æ­¥ä¼¤äº¡: number,
    æ¯æ­¥å»ºç­‘æŸæ¯: number,
    ç ´ååŠ›ç­‰çº§: string,
    ç‰¹æ®Šæ•ˆåº”: string[],
  }
}
```

**è´¡çŒ®çš„æç¤ºè¯æ¨¡æ¿**ï¼š
- `damage-calculation`: æŸå®³è®¡ç®—æ•°æ®
- `damage-rules`: æŸå®³æå†™æŒ‡å—ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰

---

### ç‰©å“ç³»ç»Ÿæ‰©å±• (items-system)

ç®¡ç†å’Œè®¡ç®—è§’è‰²æºå¸¦çš„ç‰©å“ï¼Œæä¾›å°ºå¯¸å¯¹æ¯”å’Œäº’åŠ¨å¯èƒ½æ€§åˆ†æã€‚

**ID**ï¼š`items-system`

**åŠŸèƒ½**ï¼š
- ç®¡ç†è§’è‰²ç‰©å“åˆ—è¡¨
- è®¡ç®—ç‰©å“éšè§’è‰²ç¼©æ”¾åçš„å°ºå¯¸
- åˆ†æç‰©å“ä¸è§’è‰²çš„ç›¸å¯¹å¤§å°
- åˆ¤æ–­å„ç§äº’åŠ¨çš„å¯è¡Œæ€§ï¼ˆæ¡æŒã€ç©¿æˆ´ã€åå’½ç­‰ï¼‰
- ç”ŸæˆåŸºäºæè´¨å’Œå°ºå¯¸çš„ç‰¹æ®Šæ•ˆæœ

**è´¡çŒ®çš„æ•°æ®**ï¼š
```javascript
{
  _ç‰©å“: {
    [ç‰©å“ID]: {
      åç§°: string,
      åŸå§‹å°ºå¯¸: {
        é•¿?: number,
        å®½?: number,
        é«˜?: number,
        ç›´å¾„?: number,
        é‡é‡?: number,
      },
      ç±»å‹?: string,    // æ—¥ç”¨å“/é…é¥°/æœè£…/é£Ÿç‰©/äº¤é€šå·¥å…·ç­‰
      æè´¨?: string,    // é‡‘å±/ç»ç’ƒ/å¡‘æ–™/å¸ƒæ–™ç­‰
      éšèº«æºå¸¦?: boolean, // æ˜¯å¦éšè§’è‰²ç¼©æ”¾
    }
  },
  _ç‰©å“è®¡ç®—: {
    è§’è‰²å: string,
    å€ç‡: number,
    ç‰©å“: {
      [ç‰©å“ID]: {
        å®šä¹‰: ItemDefinition,
        ç¼©æ”¾å°ºå¯¸: ItemDimensions,
        ç¼©æ”¾å°ºå¯¸_æ ¼å¼åŒ–: Record<string, string>,
        è§’è‰²è§†è§’: ItemRelativeReference[],
        æ™®é€šäººè§†è§’: ItemRelativeReference[],
        äº’åŠ¨å¯èƒ½æ€§: ItemInteraction[],
        ç‰¹æ®Šæ•ˆæœ?: string[],
      }
    }
  }
}
```

**è´¡çŒ®çš„æç¤ºè¯æ¨¡æ¿**ï¼š
- `items-data`: ç‰©å“æ•°æ®
- `items-rules`: ç‰©å“æå†™æŒ‡å—ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰

**ç‰©å“ç±»å‹é€‰é¡¹**ï¼š
| ç±»å‹ | è¯´æ˜ |
|------|------|
| æ—¥ç”¨å“ | æ‰‹æœºã€é’¥åŒ™ã€é’±åŒ…ç­‰ |
| é…é¥° | æˆ’æŒ‡ã€é¡¹é“¾ã€è€³ç¯ç­‰ |
| æœè£… | è¡£æœã€é‹å­ç­‰ |
| é£Ÿç‰© | é£Ÿç‰©ã€é¥®æ–™ç­‰ |
| å®¶å…· | æ¡Œæ¤…ã€åºŠç­‰ |
| äº¤é€šå·¥å…· | è½¦ã€èˆ¹ã€é£æœºç­‰ |
| å»ºç­‘ | æˆ¿å±‹ã€å¤§å¦ç­‰ |
| è‡ªç„¶ç‰© | æ ‘ã€çŸ³å¤´ç­‰ |
| ç©å…· | ç©å…·ã€æ¨¡å‹ç­‰ |
| æ­¦å™¨ | æ­¦å™¨ç±» |
| å·¥å…· | å·¥å…·ç±» |
| å…¶ä»– | å…¶ä»–ç‰©å“ |

**æè´¨é€‰é¡¹**ï¼š
| æè´¨ | ç‰¹æ®Šæ•ˆæœ |
|------|----------|
| é‡‘å± | é‡é‡å·¨å¤§æ—¶è½åœ°ä¼šé€ æˆä¸¥é‡å†²å‡» |
| ç»ç’ƒ | å·¨å¤§å°ºå¯¸ä¸‹å¯èƒ½å› è‡ªé‡ç¢è£‚ |
| æ¶²ä½“ | é‡å·¨å¤§æ—¶å€¾å€’ä¼šå½¢æˆæ´ªæ°´ |
| å…¶ä»– | å¡‘æ–™ã€æœ¨æã€å¸ƒæ–™ã€çš®é©ã€æ©¡èƒ¶ã€çŸ³æã€æ··å‡åœŸã€é£Ÿæ |

**äº’åŠ¨å¯èƒ½æ€§è®¡ç®—**ï¼š
| äº’åŠ¨ | åˆ¤å®šæ¡ä»¶ | æè¿° |
|------|----------|------|
| å•æ‰‹æ¡æŒ | ç‰©å“å°ºå¯¸ â‰¤ æ‰‹æŒé•¿åº¦ Ã— 1.5 | å¯ä»¥å•æ‰‹æ¡ä½ |
| åŒæ‰‹æ¡æŒ | ç‰©å“å°ºå¯¸ â‰¤ æ‰‹æŒé•¿åº¦ Ã— 3 | å¯ä»¥åŒæ‰‹æ¡ä½ |
| æŒ‡å°–æå– | ç‰©å“å°ºå¯¸ â‰¤ æ‰‹æŒé•¿åº¦ Ã— 0.5 | å¯ä»¥ç”¨æ‰‹æŒ‡æä½ |
| ä¸€å£åä¸‹ | ç‰©å“å°ºå¯¸ â‰¤ å˜´å·´å®½åº¦ Ã— 0.5ï¼ˆä»…é£Ÿç‰©ï¼‰ | å¯ä»¥ä¸€å£åä¸‹ |
| ç©¿æˆ´ | å°ºå¯¸åŒ¹é…ï¼ˆä»…é…é¥°/æœè£…ï¼‰ | å¯ä»¥ç©¿æˆ´ |

---

## ğŸ“‹ ç±»å‹å®šä¹‰

å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼š

```typescript
// æ‰©å±•å®šä¹‰
interface Extension {
  id: string;
  name: string;
  description: string;
  icon: string;
  defaultEnabled?: boolean;
  dependencies?: string[];
  
  onInit?: () => void | Promise<void>;
  onEnable?: () => void | Promise<void>;
  onDisable?: () => void | Promise<void>;
  onCharacterUpdate?: (
    character: CharacterData,
    calcData: GiantessData | TinyData
  ) => void | Record<string, unknown>;
  onBeforePromptInject?: (context: PromptContext) => PromptContext;
  onAfterPromptInject?: (promptId: string) => void;
  
  getPromptTemplates?: () => PromptTemplate[];
  getRulesContribution?: () => string | null;
  getSettingsComponent?: () => Component;
  getCharacterCardExtra?: () => Component;
  getDebugPanelExtra?: () => Component;
}

// æ‰©å±• API
interface ExtensionAPI {
  register(extension: Extension): void;
  get(id: string): Extension | undefined;
  getAll(): Extension[];
  getEnabled(): Extension[];
  enable(id: string): boolean;
  disable(id: string): boolean;
  toggle(id: string): boolean;
  isEnabled(id: string): boolean;
  getInfo(id: string): ExtensionInfo | null;
  getAllInfo(): ExtensionInfo[];
}

// æ‰©å±•ä¿¡æ¯
interface ExtensionInfo {
  extension: Extension;
  enabled: boolean;
  canDisable: boolean;
  canEnable: boolean;
  missingDependencies?: string[];
}
```

---

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹

| å·¨å¤§å¨˜è®¡ç®—å™¨ç‰ˆæœ¬ | æ‰©å±• API ç‰ˆæœ¬ | å¤‡æ³¨ |
|-----------------|--------------|------|
| v3.0.0+ | v1.0 | åˆå§‹ç‰ˆæœ¬ |
| v3.2.0+ | v1.1 | æ·»åŠ å…¨å±€ API |

**å‘åå…¼å®¹æ‰¿è¯º**ï¼š
- æ‰©å±• API çš„ä¸»ç‰ˆæœ¬å·å˜æ›´è¡¨ç¤ºä¸å…¼å®¹
- æ¬¡ç‰ˆæœ¬å·å˜æ›´ä¿æŒå‘åå…¼å®¹

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¶æ„æ–‡æ¡£](../ARCHITECTURE.md) - é¡¹ç›®æ•´ä½“æ¶æ„
- [API æ–‡æ¡£](../API.md) - å®Œæ•´ API å‚è€ƒ
- [åä½œå¼€å‘è§„èŒƒ](../CONTRIBUTING.md) - è´¡çŒ®è€…æŒ‡å—

---

## ğŸ“… æ–‡æ¡£æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´ |
|------|------|------|
| 2025-01 | v1.0 | åˆå§‹æ–‡æ¡£ |
