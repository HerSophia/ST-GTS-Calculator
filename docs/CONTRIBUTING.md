# åä½œå¼€å‘è§„èŒƒ

æœ¬æ–‡æ¡£è§„èŒƒäº†é¡¹ç›®çš„åä½œå¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬åˆ†æ”¯ç­–ç•¥ã€æäº¤è§„èŒƒã€PR æµç¨‹ç­‰ã€‚

## ç›®å½•

- [åˆ†æ”¯ç­–ç•¥](#åˆ†æ”¯ç­–ç•¥)
- [æäº¤è§„èŒƒ](#æäº¤è§„èŒƒ)
- [PR æµç¨‹](#pr-æµç¨‹)
- [CI/CD æµç¨‹](#cicd-æµç¨‹)
- [ç‰ˆæœ¬ç®¡ç†](#ç‰ˆæœ¬ç®¡ç†)
- [ä»£ç å®¡æŸ¥](#ä»£ç å®¡æŸ¥)
- [æœ¬åœ°å¼€å‘](#æœ¬åœ°å¼€å‘)

---

## åˆ†æ”¯ç­–ç•¥

é‡‡ç”¨ **Git Flow ç®€åŒ–ç‰ˆ**ï¼Œä¸»è¦ä½¿ç”¨ä¸‰ç§åˆ†æ”¯ï¼š

```
main (ç¨³å®šå‘å¸ƒ)
  â†‘ PRï¼ˆéœ€é€šè¿‡æµ‹è¯• + ä»£ç å®¡æŸ¥ï¼‰
dev (å¼€å‘åˆ†æ”¯)
  â†‘ PR æˆ–ç›´æ¥æäº¤
feature/* (åŠŸèƒ½åˆ†æ”¯ï¼Œå¯é€‰)
```

### åˆ†æ”¯è¯´æ˜

| åˆ†æ”¯ | ç”¨é€” | ä¿æŠ¤è§„åˆ™ | CI è¡Œä¸º |
|------|------|----------|--------|
| `main` | ç¨³å®šå‘å¸ƒç‰ˆæœ¬ | ğŸ”’ éœ€è¦ PR + æµ‹è¯•é€šè¿‡ | æµ‹è¯• â†’ æ„å»º â†’ å‘å¸ƒ Release |
| `dev` | æ—¥å¸¸å¼€å‘ | âš ï¸ å»ºè®® PR | è¿è¡Œæµ‹è¯•ï¼ˆlint + type check + unit testï¼‰ |
| `feature/*` | åŠŸèƒ½å¼€å‘ | æ—  | è¿è¡Œæµ‹è¯• |
| `fix/*` | Bug ä¿®å¤ | æ—  | è¿è¡Œæµ‹è¯• |
| `docs/*` | æ–‡æ¡£æ›´æ–° | æ—  | æ—  |

### å·¥ä½œæµç¨‹

#### æ—¥å¸¸å¼€å‘

```bash
# 1. ä» dev åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout dev
git pull origin dev
git checkout -b feature/æ–°åŠŸèƒ½åç§°

# 2. å¼€å‘å¹¶æäº¤
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# 3. æ¨é€å¹¶åˆ›å»º PR åˆ° dev
git push origin feature/æ–°åŠŸèƒ½åç§°
# åœ¨ GitHub ä¸Šåˆ›å»º PR: feature/æ–°åŠŸèƒ½åç§° â†’ dev

# 4. PR åˆå¹¶ååˆ é™¤åŠŸèƒ½åˆ†æ”¯
git checkout dev
git pull origin dev
git branch -d feature/æ–°åŠŸèƒ½åç§°
```

#### å‘å¸ƒæ–°ç‰ˆæœ¬

```bash
# 1. ç¡®ä¿ dev åˆ†æ”¯æµ‹è¯•é€šè¿‡
git checkout dev
git pull origin dev
pnpm test

# 2. æ›´æ–°ç‰ˆæœ¬å·
# ä¿®æ”¹ package.json ä¸­çš„ version
# ä¿®æ”¹ src/version.ts ä¸­çš„ VERSION
# æ›´æ–° CHANGELOG

# 3. æäº¤ç‰ˆæœ¬æ›´æ–°
git add .
git commit -m "chore: bump version to x.x.x"
git push origin dev

# 4. åˆ›å»º PR: dev â†’ main
# åœ¨ GitHub ä¸Šåˆ›å»º PRï¼Œç­‰å¾…æµ‹è¯•é€šè¿‡å’Œä»£ç å®¡æŸ¥

# 5. åˆå¹¶åè‡ªåŠ¨å‘å¸ƒ Release
```

#### ç´§æ€¥ä¿®å¤

```bash
# 1. ä» main åˆ›å»ºä¿®å¤åˆ†æ”¯
git checkout main
git pull origin main
git checkout -b fix/ç´§æ€¥ä¿®å¤æè¿°

# 2. ä¿®å¤å¹¶æäº¤
git add .
git commit -m "fix: ä¿®å¤ç´§æ€¥é—®é¢˜"

# 3. åˆ›å»º PR åˆ° mainï¼ˆç´§æ€¥æƒ…å†µï¼‰
# æˆ–åˆ›å»º PR åˆ° devï¼ˆå¸¸è§„ä¿®å¤ï¼‰
```

---

## æäº¤è§„èŒƒ

é‡‡ç”¨ **Conventional Commits** è§„èŒƒï¼š

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

### Type ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `feat` | æ–°åŠŸèƒ½ | `feat: æ·»åŠ æŸå®³è®¡ç®—ç³»ç»Ÿ` |
| `fix` | Bug ä¿®å¤ | `fix: ä¿®å¤èº«é«˜è®¡ç®—ç²¾åº¦é—®é¢˜` |
| `docs` | æ–‡æ¡£æ›´æ–° | `docs: æ›´æ–° README å®‰è£…æ•™ç¨‹` |
| `style` | ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰ | `style: æ ¼å¼åŒ–ä»£ç ` |
| `refactor` | é‡æ„ï¼ˆä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤ï¼‰ | `refactor: é‡æ„è®¡ç®—æœåŠ¡` |
| `perf` | æ€§èƒ½ä¼˜åŒ– | `perf: ä¼˜åŒ–å¤§æ•°æ®é‡è®¡ç®—æ€§èƒ½` |
| `test` | æµ‹è¯•ç›¸å…³ | `test: æ·»åŠ è®¡ç®—å™¨å•å…ƒæµ‹è¯•` |
| `chore` | æ„å»º/å·¥å…·ç›¸å…³ | `chore: æ›´æ–°ä¾èµ–ç‰ˆæœ¬` |
| `ci` | CI é…ç½® | `ci: æ·»åŠ è‡ªåŠ¨æµ‹è¯• workflow` |

### Scope èŒƒå›´ï¼ˆå¯é€‰ï¼‰

| èŒƒå›´ | è¯´æ˜ |
|------|------|
| `core` | æ ¸å¿ƒè®¡ç®—é€»è¾‘ |
| `ui` | UI ç»„ä»¶ |
| `store` | Pinia çŠ¶æ€ç®¡ç† |
| `service` | ä¸šåŠ¡æœåŠ¡ |
| `mvu` | MVU é›†æˆ |
| `prompt` | æç¤ºè¯ç³»ç»Ÿ |
| `damage` | æŸå®³è®¡ç®— |
| `worldview` | ä¸–ç•Œè§‚ç³»ç»Ÿ |
| `extension` | æ‰©å±•ç³»ç»Ÿ |

### ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(damage): æ·»åŠ å®¤å†…åœºæ™¯æ”¯æŒ"

# Bug ä¿®å¤
git commit -m "fix(core): ä¿®å¤å°æ•°ç²¾åº¦ä¸¢å¤±é—®é¢˜"

# é‡æ„
git commit -m "refactor(ui): æ‹†åˆ† Panel.vue ä¸ºå¤šä¸ªå­ç»„ä»¶"

# æ–‡æ¡£
git commit -m "docs: æ·»åŠ åä½œå¼€å‘è§„èŒƒæ–‡æ¡£"

# å¸¦è¯¦ç»†è¯´æ˜çš„æäº¤
git commit -m "feat(extension): æ·»åŠ æ‰©å±•ç”Ÿå‘½å‘¨æœŸé’©å­

- æ·»åŠ  onInit, onEnable, onDisable é’©å­
- æ·»åŠ  onCharacterUpdate é’©å­
- æ›´æ–°æ‰©å±•æ¥å£ç±»å‹å®šä¹‰

Closes #123"
```

---

## PR æµç¨‹

### åˆ›å»º PR

1. **æ ‡é¢˜æ ¼å¼**ï¼šä¸æäº¤ä¿¡æ¯æ ¼å¼ä¸€è‡´
   - âœ… `feat: æ·»åŠ æŸå®³è®¡ç®—ç³»ç»Ÿ`
   - âŒ `æ·»åŠ äº†ä¸€äº›åŠŸèƒ½`

2. **æè¿°æ¨¡æ¿**ï¼š

```markdown
## ğŸ“‹ å˜æ›´è¯´æ˜

ç®€è¦æè¿°è¿™ä¸ª PR åšäº†ä»€ä¹ˆã€‚

## ğŸ”„ å˜æ›´ç±»å‹

- [ ] æ–°åŠŸèƒ½ (feat)
- [ ] Bug ä¿®å¤ (fix)
- [ ] é‡æ„ (refactor)
- [ ] æ–‡æ¡£ (docs)
- [ ] æµ‹è¯• (test)
- [ ] å…¶ä»–

## ğŸ“ å˜æ›´å†…å®¹

- å˜æ›´ç‚¹ 1
- å˜æ›´ç‚¹ 2

## ğŸ§ª æµ‹è¯•

- [ ] å·²æ·»åŠ /æ›´æ–°ç›¸å…³æµ‹è¯•
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (`pnpm test`)
- [ ] å·²åœ¨æœ¬åœ°æµ‹è¯•åŠŸèƒ½

## ğŸ“¸ æˆªå›¾ï¼ˆå¦‚é€‚ç”¨ï¼‰

## ğŸ”— ç›¸å…³ Issue

Closes #
```

### PR æ£€æŸ¥æ¸…å•

- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] æäº¤ä¿¡æ¯ç¬¦åˆ Conventional Commits
- [ ] æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ— åˆå¹¶å†²çª

### åˆå¹¶ç­–ç•¥

- **dev â†’ main**ï¼šä½¿ç”¨ **Squash and merge**ï¼Œåˆå¹¶ä¸ºå•ä¸ªæäº¤
- **feature â†’ dev**ï¼šä½¿ç”¨ **Squash and merge** æˆ– **Rebase and merge**

---

## CI/CD æµç¨‹

### Workflow è¯´æ˜

| Workflow | è§¦å‘æ¡ä»¶ | æ‰§è¡Œå†…å®¹ |
|----------|----------|----------|
| `test.yaml` | PR / push to dev | lint, type-check, unit test |
| `bundle.yaml` | push to main | æ„å»º + å‘å¸ƒ Release |

### æµ‹è¯• Workflow (`test.yaml`)

```yaml
è§¦å‘æ¡ä»¶:
  - PR åˆ° dev æˆ– main
  - push åˆ° dev åˆ†æ”¯
  - push åˆ° feature/* åˆ†æ”¯

æ‰§è¡Œæ­¥éª¤:
  1. å®‰è£…ä¾èµ–
  2. è¿è¡Œ ESLint æ£€æŸ¥
  3. è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥
  4. è¿è¡Œå•å…ƒæµ‹è¯•
  5. (å¯é€‰) ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
```

### å‘å¸ƒ Workflow (`bundle.yaml`)

```yaml
è§¦å‘æ¡ä»¶:
  - push åˆ° main åˆ†æ”¯
  - æ‰‹åŠ¨è§¦å‘

æ‰§è¡Œæ­¥éª¤:
  1. å®‰è£…ä¾èµ–
  2. è¿è¡Œæµ‹è¯•ï¼ˆç¡®ä¿é€šè¿‡ï¼‰
  3. æ„å»ºé¡¹ç›®
  4. æ³¨å…¥åˆ° JSON
  5. æäº¤æ„å»ºäº§ç‰©
  6. åˆ›å»º/æ›´æ–° GitHub Release
  7. ä¸Šä¼  JSON æ–‡ä»¶åˆ° Release
```

### æœ¬åœ°æµ‹è¯•

æäº¤å‰è¯·ç¡®ä¿æœ¬åœ°æµ‹è¯•é€šè¿‡ï¼š

```bash
# å®Œæ•´æµ‹è¯•
pnpm test

# æˆ–åˆ†æ­¥æ‰§è¡Œ
pnpm lint          # ESLint æ£€æŸ¥
pnpm type-check    # TypeScript ç±»å‹æ£€æŸ¥ï¼ˆéœ€æ·»åŠ ï¼‰
pnpm test:run      # å•å…ƒæµ‹è¯•
```

---

## ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬å·è§„èŒƒ

é‡‡ç”¨ **è¯­ä¹‰åŒ–ç‰ˆæœ¬** (Semantic Versioning)ï¼š

```
MAJOR.MINOR.PATCH
  â”‚     â”‚     â””â”€â”€ ä¿®è®¢å·ï¼šBug ä¿®å¤ï¼Œå‘åå…¼å®¹
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€ æ¬¡ç‰ˆæœ¬å·ï¼šæ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»ç‰ˆæœ¬å·ï¼šç ´åæ€§å˜æ›´ï¼Œä¸å‘åå…¼å®¹
```

### ç‰ˆæœ¬æ›´æ–°ä½ç½®

æ›´æ–°ç‰ˆæœ¬æ—¶éœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`package.json`**ï¼š
   ```json
   {
     "version": "2.7.0"
   }
   ```

2. **`src/version.ts`**ï¼š
   ```typescript
   export const VERSION = '2.7.0';
   
   export const CHANGELOG = [
     {
       version: '2.7.0',
       date: '2024-xx',
       changes: [
         'æ–°å¢ï¼šxxx',
         'ä¿®å¤ï¼šxxx',
       ],
     },
     // ... å†å²ç‰ˆæœ¬
   ];
   ```

### ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ›´æ–° `package.json` ç‰ˆæœ¬å·
- [ ] æ›´æ–° `src/version.ts` ç‰ˆæœ¬å·å’Œ CHANGELOG
- [ ] æ›´æ–° `README.md` ç‰ˆæœ¬ä¿¡æ¯ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] åˆ›å»º PR åˆ° main
- [ ] PR å®¡æŸ¥é€šè¿‡å¹¶åˆå¹¶
- [ ] æ£€æŸ¥ Release æ˜¯å¦æ­£ç¡®åˆ›å»º

---

## ä»£ç å®¡æŸ¥

### å®¡æŸ¥é‡ç‚¹

1. **åŠŸèƒ½æ­£ç¡®æ€§**
   - ä»£ç æ˜¯å¦å®ç°äº†é¢„æœŸåŠŸèƒ½ï¼Ÿ
   - è¾¹ç•Œæƒ…å†µæ˜¯å¦å¤„ç†ï¼Ÿ

2. **ä»£ç è´¨é‡**
   - æ˜¯å¦ç¬¦åˆé¡¹ç›®æ¶æ„ï¼ˆåˆ†å±‚è®¾è®¡ï¼‰ï¼Ÿ
   - æ˜¯å¦æœ‰é‡å¤ä»£ç ï¼Ÿ
   - å‘½åæ˜¯å¦æ¸…æ™°ï¼Ÿ

3. **ç±»å‹å®‰å…¨**
   - æ˜¯å¦æœ‰ `any` ç±»å‹æ»¥ç”¨ï¼Ÿ
   - ç±»å‹å®šä¹‰æ˜¯å¦å®Œæ•´ï¼Ÿ

4. **æµ‹è¯•è¦†ç›–**
   - æ˜¯å¦æ·»åŠ äº†ç›¸å…³æµ‹è¯•ï¼Ÿ
   - æµ‹è¯•ç”¨ä¾‹æ˜¯å¦å……åˆ†ï¼Ÿ

5. **æ–‡æ¡£**
   - å…¬å…± API æ˜¯å¦æœ‰æ³¨é‡Šï¼Ÿ
   - README æ˜¯å¦éœ€è¦æ›´æ–°ï¼Ÿ

### å®¡æŸ¥å›å¤è§„èŒƒ

| å‰ç¼€ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `blocker:` | å¿…é¡»ä¿®å¤ | `blocker: è¿™é‡Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±` |
| `suggestion:` | å»ºè®®ä¿®æ”¹ | `suggestion: è¿™é‡Œå¯ä»¥ç”¨ map ä»£æ›¿ forEach` |
| `question:` | ç–‘é—® | `question: è¿™ä¸ªé€»è¾‘çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ` |
| `nitpick:` | å°é—®é¢˜ | `nitpick: è¿™é‡Œå¤šäº†ä¸€ä¸ªç©ºè¡Œ` |
| `praise:` | èµæ‰¬ | `praise: è¿™ä¸ªæŠ½è±¡è®¾è®¡å¾—å¾ˆå¥½ï¼` |

---

## æœ¬åœ°å¼€å‘

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18
- pnpm >= 8

### å¸¸ç”¨å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
pnpm watch

# ç”Ÿäº§æ„å»º
pnpm build

# æ„å»ºå¹¶æ³¨å…¥åˆ° JSON
pnpm build:inject

# ä»£ç æ ¼å¼åŒ–
pnpm format

# ESLint æ£€æŸ¥
pnpm lint
pnpm lint:fix

# è¿è¡Œæµ‹è¯•
pnpm test           # ç›‘å¬æ¨¡å¼
pnpm test:run       # å•æ¬¡è¿è¡Œ
pnpm test:coverage  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:ui        # å¯è§†åŒ–æµ‹è¯•ç•Œé¢
```

### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒè®¡ç®—ï¼ˆçº¯å‡½æ•°ï¼‰
â”‚   â”œâ”€â”€ stores/             # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ composables/        # Vue Composables
â”‚   â”œâ”€â”€ ui/                 # UI ç»„ä»¶
â”‚   â””â”€â”€ types/              # ç±»å‹å®šä¹‰
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”œâ”€â”€ json/                   # é…’é¦†åŠ©æ‰‹è„šæœ¬ JSON
â”œâ”€â”€ script/                 # è¾…åŠ©è„šæœ¬
â””â”€â”€ dist/                   # æ„å»ºè¾“å‡º
```

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è°ƒè¯•æ¨¡å¼**ï¼šåœ¨è®¾ç½®ä¸­å¼€å¯ã€Œè°ƒè¯•æ¨¡å¼ã€
2. **æ§åˆ¶å° API**ï¼šä½¿ç”¨ `window.GiantessCalc` è¿›è¡Œè°ƒè¯•
3. **Vue DevTools**ï¼šä½¿ç”¨ Vue DevTools æŸ¥çœ‹ç»„ä»¶çŠ¶æ€

---

## å¸¸è§é—®é¢˜

### Q: PR æµ‹è¯•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æŸ¥çœ‹ Actions æ—¥å¿—ï¼Œå®šä½å¤±è´¥åŸå› 
2. æœ¬åœ°è¿è¡Œ `pnpm test` å¤ç°é—®é¢˜
3. ä¿®å¤åé‡æ–°æ¨é€

### Q: å¦‚ä½•åŒæ­¥ä¸Šæ¸¸æ¨¡æ¿æ›´æ–°ï¼Ÿ

æœ¬é¡¹ç›®åŸºäº `tavern_helper_template`ï¼Œå¦‚éœ€åŒæ­¥æ¨¡æ¿æ›´æ–°ï¼š

```bash
# æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/StageDog/tavern_helper_template.git

# è·å–æ›´æ–°
git fetch upstream

# æŸ¥çœ‹å·®å¼‚
git diff dev upstream/main -- webpack.config.ts

# é€‰æ‹©æ€§åˆå¹¶ï¼ˆè°¨æ…æ“ä½œï¼‰
```

### Q: ç‰ˆæœ¬å·åº”è¯¥å¦‚ä½•é€’å¢ï¼Ÿ

- **PATCH** (x.x.1 â†’ x.x.2)ï¼šBug ä¿®å¤ã€å°æ”¹åŠ¨
- **MINOR** (x.1.x â†’ x.2.0)ï¼šæ–°åŠŸèƒ½ã€ä¸ç ´åå…¼å®¹æ€§çš„æ”¹è¿›
- **MAJOR** (1.x.x â†’ 2.0.0)ï¼šç ´åæ€§å˜æ›´ã€API æ”¹åŠ¨

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- ğŸ“ [åˆ›å»º Issue](https://github.com/HerSophia/ST-GTS-Calculator/issues/new)
- ğŸ’¬ åœ¨ PR ä¸­è®¨è®º
