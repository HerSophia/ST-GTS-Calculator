/**
 * 巨大娘计算器 - 版本信息
 */

export const VERSION = '3.4.0';

export const CHANGELOG = [
  {
    version: '3.4.0',
    date: '2025-01',
    changes: [
      '🌍 **场景系统增强**',
      '',
      '**自定义人群密度**',
      '新增：场景数据支持 `人群密度` 字段，可直接指定密度值',
      '新增：自定义密度优先级高于场景预设，适合特殊情况',
      '新增：损害计算函数支持 `DamageCalculationOptions` 选项',
      '优化：提示词模板添加密度设置说明和各场景默认值',
      '',
      '**扩展场景信息**',
      '新增：`具体地点` - 详细地点描述（如东京银座）',
      '新增：`场景时间` - 当前时间段（如傍晚、深夜）',
      '新增：`人群状态` - 人群密集程度（如拥挤、撤离中）',
      '优化：调试信息返回完整场景数据',
      '',
      '**UI 改进**',
      'UI：场景显示组件支持自定义密度标识（橙色）',
      'UI：message-display 显示完整场景信息卡片',
      'UI：身体数据折叠 - 重要数据始终显示，详情可展开',
      'UI：视角数据折叠 - 巨大娘/小人视角分别优化',
      'UI：按钮栏布局优化，紧凑居中显示',
      '',
      '**文档更新**',
      '更新：README.md 场景设置说明',
      '更新：damage-core/README.md API 文档',
    ],
  },
  {
    version: '3.3.0',
    date: '2025-01',
    changes: [
      '🔄 **变量服务系统全面重构**',
      '',
      '**架构重构**',
      '重构：变量服务拆分为 5 个独立模块（reader/writer/parser/sync/event-handler）',
      '重构：明确分离公开 API 和内部 API（_internal_ 前缀标识）',
      '重构：统一数据流：酒馆变量 ↔ Variables Service ↔ Stores ↔ UI',
      '新增：处理状态管理机制，防止重复处理同一消息',
      '新增：内容哈希比对，避免无变化时的重复计算',
      '',
      '**事件处理优化**',
      '重构：事件处理流程，支持 GENERATION_ENDED / MESSAGE_SWIPED / CHAT_CHANGED 等事件',
      '新增：parseAndProcessMessage() 统一消息处理入口',
      '新增：fullDataProcess() 完整数据处理流水线',
      '优化：智能判断是否需要重新计算（needsRecalculation）',
      '优化：智能判断是否需要重新注入提示词（reinjectPromptsIfNeeded）',
      '',
      '**解析器增强**',
      '新增：parseAllUpdateCommands() 统一解析入口',
      '新增：支持 <gts_update> 标签和独立 _.set() 命令',
      '新增：deepEqual() 深度比较，filterChangedUpdates() 过滤无变化更新',
      '新增：hashContent() 内容哈希，用于变化检测',
      '',
      '**读写分离**',
      '新增：reader.ts - 统一的数据读取接口',
      '新增：writer.ts - 统一的数据写入接口',
      '新增：appendToArray() 通用数组追加函数',
      '新增：处理状态读写（writeProcessingState/readProcessingState）',
      '',
      '**测试系统**',
      '新增：完整的单元测试覆盖（reader/writer/parser/sync/event-handler）',
      '新增：测试 fixtures 和 mocks',
      '新增：parser-comparison.test.ts 解析器对比测试',
      '新增：processing-state.test.ts 处理状态测试',
      '',
      '**文档完善**',
      '新增：ARCHITECTURE.md - 完整架构文档',
      '新增：API.md - 三层 API 文档（全局/Core/Service）',
      '更新：DATA_PROCESSING_MECHANISM.md - 数据处理流程详解',
      '更新：VARIABLE_SYSTEM_REFACTOR.md - 变量系统设计文档',
      '',
      '**向后兼容**',
      '兼容：原有 MVU 变量结构完全兼容',
      '兼容：全局 API (window.GiantessCalc) 完全兼容',
      '兼容：Services 层导出保持兼容',
    ],
  },
  {
    version: '3.2.0',
    date: '2025-01',
    changes: [
      '**核心功能**',
      '新增：扩展系统规则贡献机制 - 扩展可追加规则到主规则模板',
      '新增：损害扩展自动追加「实际损害记录」规则',
      '新增：脚本初始化时自动注入基础提示词',
      '',
      '**提示词模板系统**',
      '新增：提示词模板只读属性 - 核心模板（角色数据、变量更新规则、世界观设定、损害计算）不可编辑',
      '新增：只读模板预览视图，显示锁定提示和扩展追加说明',
      '变更：Order 排序规则改为降序（order 越大越靠前），适合长上下文',
      '变更：变量更新规则位置调整到紧随头部说明（order: 9995）',
      '变更：重置为默认时保留用户创建的自定义模板',
      '',
      '**初始化优化**',
      '优化：MVU 初始化改用轮询方式检测（最多等待 5 秒），解决阻塞问题',
      '优化：初始化完成后自动注入提示词，无需手动触发',
      '',
      '**UI 改进**',
      'UI：只读模板显示黄色「只读」徽章和左侧边框标识',
      'UI：只读模板操作按钮从编辑改为查看（👁️）',
    ],
  },
  {
    version: '3.1.0',
    date: '2025-01',
    changes: [
      '**重要变更**：MVU 变量结构重构',
      '新增：Zod Schema 定义，支持 MVU 变量验证',
      '变更：角色数据路径从 `巨大娘.角色名` 改为 `巨大娘.角色.角色名`',
      '新增：自动迁移旧格式数据到新格式',
      '新增：`getCharacterPath()` 工具函数获取角色路径',
      '优化：Schema 支持动态添加角色（z.record）',
      '文档：新增 MVU_SCHEMA_MIGRATION.md 迁移指南',
    ],
  },
  {
    version: '2.8.0',
    date: '2025-01',
    changes: [
      '新增：MVU 世界书初始化 - 通过世界书自动初始化 MVU 变量结构',
      '新增：自动创建并绑定「巨大娘计算器_MVU初始化」世界书',
      '新增：[InitVar] 条目包含完整的变量结构模板',
      '优化：提示词注入深度设置范围扩大（0-9999）',
      '优化：增强提示词模板内容，提供更详细的指引',
      '修复：MVU 初始化流程，确保变量结构在脚本加载时就绑定',
    ],
  },
  {
    version: '2.7.0',
    date: '2025-01',
    changes: [
      '新增：自动更新检查 - 启动时自动检查是否有新版本',
      '新增：设置面板显示当前版本和更新状态',
      '新增：手动检查更新按钮',
      '新增：发现新版本时显示更新提示和下载链接',
      '新增：可选择忽略特定版本的更新提示',
      '新增：自动检查更新开关（默认开启，每24小时检查一次）',
      '优化：设置面板分组显示，结构更清晰',
    ],
  },
  {
    version: '2.6.0',
    date: '2024-02',
    changes: [
      '新增：损害计算系统 - 计算巨大娘行动可能造成的破坏',
      '新增：人员伤亡估算（支持10种人口密度场景）',
      '新增：建筑损毁、街道/城区毁坏估算',
      '新增：宏观破坏力计算（城市/国家/大陆/行星/恒星/星系/宇宙级）',
      '新增：特殊物理效应提示（地震、海啸、引力场等）',
      '新增：扩展系统控制面板 - 在角色列表下方统一管理各计算模块',
      '新增：按角色显示损害数据和汇总统计',
      '新增：损害提示词模板，支持自动注入到 AI 提示词',
      '优化：角色卡片展示损害数据详情',
      '优化：支持多巨大娘损害汇总计算',
    ],
  },
  {
    version: '2.5.0',
    date: '2024-02',
    changes: [
      '新增：单独部位变化功能 - 可为特定部位设置独立尺寸',
      '新增：自定义部位字段支持，允许部位有不同于整体的变化倍率',
      '新增：自定义部位在输出中带有 ⚡ 标记，便于识别',
      '新增：提示词模板支持 {{自定义部位}} 变量',
      '更新：变量更新规则增加单独部位设置说明',
      '优化：身体数据使用格式化后的值显示',
    ],
  },
  {
    version: '2.4.0',
    date: '2024-02',
    changes: [
      '新增：世界观模板系统 - 支持不同设定下的变化机制',
      '新增：8种内置世界观（现实物理、玄幻修仙、科幻科技、魔法少女等）',
      '新增：世界观快速切换器，一键切换不同设定',
      '新增：世界观详情面板，展示变化机制、身体特性、特殊规则',
      '新增：自定义世界观创建和编辑功能',
      '新增：世界观提示词自动注入到 AI 提示词',
      '优化：提示词模板系统增加世界观类型支持',
    ],
  },
  {
    version: '2.3.0',
    date: '2024-02',
    changes: [
      '新增：提示词模板管理系统',
      '新增：可自定义、启用/禁用各类提示词模板',
      '新增：支持创建、编辑、删除自定义模板',
      '新增：模板顺序调整功能',
      '新增：内置变量更新规则模板，指导 AI 更新角色数据',
      '新增：模板支持变量插值（如 {{角色名}}、{{身体数据}} 等）',
      '新增：模板数据存储到全局变量，跨聊天持久化',
      '优化：移除旧的自定义提示词头部，改用更灵活的模板系统',
    ],
  },
  {
    version: '2.2.0',
    date: '2024-02',
    changes: [
      '数据存储：将角色数据存储位置从聊天变量改为楼层变量',
      '数据存储：每条消息可拥有独立的数据快照',
      '调试功能：调试数据也存储在楼层变量中',
    ],
  },
  {
    version: '2.1.0',
    date: '2024-02',
    changes: [
      'UI重构：全新现代化界面，更优雅简约',
      'UI优化：引入 Font Awesome 图标库',
      'UI优化：面板高度自适应，大屏浏览体验更好',
      '核心优化：内置 MVU 集成，无需额外安装依赖',
    ],
  },
  {
    version: '2.0.0',
    date: '2024-01',
    changes: [
      '重构：使用 Vue 3 + Pinia 重写 UI',
      '重构：使用 TailwindCSS 编写样式',
      '重构：模块化架构，符合 tavern_helper_template 规范',
      '优化：代码结构更清晰',
      '优化：设置自动持久化到脚本变量',
    ],
  },
  {
    version: '1.2.0',
    date: '2024-01',
    changes: [
      '重构：迁移到 tavern_helper_template 模板',
      '新增：TypeScript 支持',
      '新增：模块化架构',
      '优化：代码结构和可维护性',
    ],
  },
  {
    version: '1.1.0',
    date: '2024-01',
    changes: [
      '新增：角色卡片可展开显示详细数据',
      '新增：自定义提示词头部功能',
      '新增：帮助说明和更新日志面板',
      '优化：UI 交互体验',
    ],
  },
  {
    version: '1.0.0',
    date: '2024-01',
    changes: [
      '初始版本发布',
      '支持巨大化/缩小化身体数据计算',
      '支持相对尺寸参照物计算',
      '支持互动限制检查',
      'MVU 变量集成和提示词注入',
    ],
  },
];
